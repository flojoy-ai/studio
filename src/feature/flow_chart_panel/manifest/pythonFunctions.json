{"SIMULATION": {"FEEDBACK.py": "from flojoy import flojoy, DataContainer\nimport os\nfrom redis import Redis\nfrom rq.job import Job, NoSuchJobError\n\nREDIS_HOST = os.environ.get('REDIS_HOST', 'localhost')\nREDIS_PORT = os.environ.get('REDIS_PORT', 6379)\n\n\n@flojoy\ndef FEEDBACK(v, params):\n    referred_node = params['node_id']\n    jobset_id = params['jobset_id']\n\n    x = v[0].y\n\n    try:\n        job = Job.fetch(\"{}_{}\".format(jobset_id, referred_node), connection=Redis(\n            host=REDIS_HOST, port=REDIS_PORT))\n        y = job.result.y\n    except (Exception, NoSuchJobError):\n        y = v[0].y if len(v) > 0 else [1, 3, 2]\n        pass;\n\n    return DataContainer(x=x, y=y)\n", "LINSPACE.py": "import numpy as np\nfrom flojoy import flojoy, DataContainer\n\n@flojoy\ndef LINSPACE(v, params):\n    x = None\n    if v.__len__() > 0:\n        x = v[0].y\n    y = np.linspace(int(params['start']), int(params['end']), int(params['step']))\n    result = DataContainer(x = x, y = y)\n    return result", "SINE.py": "import numpy as np\nfrom flojoy import flojoy, DataContainer\nfrom scipy import signal\n\n@flojoy\ndef SINE(v, params):\n    valid_waveforms = [\"sine\", \"square\", \"triangle\", \"sawtooth\"]\n    print(' sine params: ', params)\n    x = None\n    if v.__len__() > 0:\n        x = v[0].y\n\n    waveform = params['waveform']\n    A = int(params['amplitude'])\n    F = int(params['frequency'])\n    Y0 =int( params['offset'])\n    if waveform not in valid_waveforms:\n        waveform = valid_waveforms[0]\n        print('invalid waveform passed as param, using default:', waveform)\n\n    if waveform == 'sine':\n        y = Y0 + A * np.sin(np.radians(2 * np.pi * F) * x)\n    elif waveform == 'square':\n        y = Y0 + A * signal.square(2 * np.pi * F * x / 10)\n    elif waveform == 'triangle':\n        y = Y0 + A * signal.sawtooth(2 * np.pi * F * x / 10, 0.5)\n    elif waveform == 'sawtooth':\n        y = Y0 + A * signal.sawtooth(2 * np.pi * F / 10 * x)\n\n    return DataContainer(x = x, y = y)\n", "RAND.py": "import numpy as np\nfrom flojoy import flojoy, DataContainer\nimport traceback\n\n@flojoy\ndef RAND(v, params):\n    x = None\n    if len(v) > 0:\n        x = v[0].y\n        # For now return fixed value for y key\n        # Later on, A env variable will be used to return fixed value for testing\n        y = x\n        # y = np.random.normal(size=len(x))\n    else:\n        y = np.full(1000, 1000)\n\n    return DataContainer(x=x, y=y)", "CONSTANT.py": "import numpy as np\nfrom flojoy import flojoy, DataContainer\n\n@flojoy\ndef CONSTANT(v, params):\n    # ''' Generates a single x-y vector of numeric (floating point) constants'''\n    print('constant params: ',params)\n\n    if v.__len__() > 0:\n        x = v[0].y\n        y = np.full(len(x), float(params['constant']))\n        return DataContainer(x = x, y = y)\n\n    x = list()\n    for i in range(1000):\n        x.append(i)\n    y = np.full(1000, float(params['constant']))\n\n    return DataContainer(x = x, y = y)\n", "OBJECT_DETECTION.py": "import traceback\nfrom flojoy import flojoy, DataContainer\n\nfrom utils.object_detection.object_detection import detect_object\n\n\n@flojoy\ndef OBJECT_DETECTION(v, params):\n    try:\n        print('Detecting objects...')\n        data = v[0].y[0]\n        y = [detect_object(data)]\n        file_type = v[0].file_type\n        return DataContainer(type='file', y=y, file_type=file_type)\n    except Exception:\n        print(traceback.format_exc())\n        raise\n", "TIMESERIES.py": "import numpy as np\nfrom flojoy import flojoy, DataContainer\nimport pandas.util.testing as testing\nimport traceback\n\n@flojoy\ndef TIMESERIES(v, params):\n    \"\"\"\n    Generates a random timeseries vector\n    \"\"\"\n\n    try:\n        np.random.seed(1)\n        testing.N, testing.K = 1000, 1 # rows, columns\n        df = testing.makeTimeDataFrame(freq='MS')\n    except Exception:\n        print(traceback.format_exc())\n\n    return DataContainer(x = df.index.to_numpy(), y = df['A'].to_numpy())"}, "ARITHMETIC": {"ADD.py": "import numpy as np\nfrom flojoy import flojoy, DataContainer\n\n@flojoy\ndef ADD(v, params):\n    ''' Add 2 input vectors and return the result '''\n    # print(' v in add node: ', v)\n    a = [0]\n    b = [0]\n\n    if len(v) == 2:\n        a = v[0].y\n        b = v[1]['y']\n\n    y = np.add(a, b)\n    \n    return DataContainer(x={'a':a, 'b':b}, y=y)\n", "SUBTRACT.py": "import numpy as np\nfrom flojoy import flojoy, DataContainer\n\n@flojoy\ndef SUBTRACT(v, params):\n    ''' Subtract 2 input vectors and return the result '''\n    # print(' v in add node: ', v)\n    a = [0]\n    b = [0]\n\n    if len(v) == 2:\n        a = v[0].y\n        b = v[1]['y']\n\n    y = np.subtract(a, b)\n\n    return DataContainer(x = [a, b], y = y)", "MULTIPLY.py": "import numpy as np\nfrom flojoy import flojoy, DataContainer\n\n\n@flojoy\ndef MULTIPLY(v, params):\n    ''' Takes 2 input vectors, multiplies them, and returns the result '''\n    a = v[0].y\n    b = v[1].y\n    y = np.multiply(a, b)\n    return DataContainer(x={'a':a, 'b':b}, y=y)\n"}, "VISOR": {"SURFACE3D.py": "from flojoy import flojoy\nfrom .template import init_template\n\n@flojoy\ndef SURFACE3D(v, params):\n\n    fig = dict(\n        data = [dict(\n            x = list(v[0].x),\n            y = list(v[0].y),\n            z = list([0] * len(v[0].y)),\n            type='surface'\n        )],\n        layout = dict(template = init_template())\n    )\n    # list(v[0].z) if v[0].z is not None else\n    return fig", "HISTOGRAM.py": "from flojoy import flojoy\nfrom .template import init_template\n\n@flojoy\ndef HISTOGRAM(v, params):\n\n    fig = dict(\n        data = [dict(\n            x = list(v[0].x),\n            type='histogram'\n        )],\n        layout = dict(template = init_template())\n    )\n    return fig", "LINE.py": "from flojoy import flojoy, JobResultBuilder\n\n@flojoy\ndef LINE(v, params):\n    return JobResultBuilder().from_params(v).build()\n", "SCATTER3D.py": "from flojoy import flojoy\nfrom .template import init_template\n\n@flojoy\ndef SCATTER3D(v, params):\n\n    fig = dict(\n        data = [dict(\n            x = list(v[0].x),\n            y = list(v[0].y),\n            z =  list([0] * len(v[0].x)),\n            type='scatter3d',\n            mode='markers'\n        )],\n        layout = dict(template = init_template())\n    )\n    # list(v[0].z) if v[0].z is not None else\n    return fig", "SCATTER.py": "from flojoy import flojoy\nfrom .template import init_template\n\n@flojoy\ndef SCATTER(v, params):\n\n    fig = dict(\n        data = [dict(\n            x = list(v[0].x),\n            y = list(v[0].y),\n            type='scatter',\n            mode='markers'\n        )],\n        layout = dict(template = init_template())\n    )\n    return fig", "BAR.py": "from flojoy import flojoy\nfrom .template import init_template\n\n@flojoy\ndef BAR(v, params):\n    fig = dict(\n        data = [dict(\n            x = list(v[0].x),\n            y = list(v[0].y),\n            type='bar'\n        )],\n        layout = dict(template = init_template())\n    )\n    return fig", "template.py": "import plotly.graph_objects as go\n\ndef init_template():\n\n    template = go.layout.Template()\n\n    # pythonic autotyping of numeric strings\n    template.layout.autotypenumbers = \"strict\"\n\n    # minimiz margins\n    # template.layout.margin = dict(t=0, l=10, b=10, r=0)\n\n    return template\n\n", "IMAGE.py": "from flojoy import flojoy\nfrom ..VISORS.template import init_template\n\n@flojoy\ndef IMAGE(v, params):\n\n    fig = dict(\n        data = [dict(\n            y = list(v[0].y[0]),\n            type='image'\n        )],\n        layout = dict(template = init_template())\n    )\n    return fig"}, "CONDITIONAL": {"CONDITIONAL.py": "from flojoy import flojoy, DataContainer, JobResultBuilder\n\n\ndef compare_values(first_value, second_value, operator):\n    bool_ = None\n    if operator == \"<=\":\n        bool_ = first_value <= second_value\n    elif operator == \">\":\n        bool_ = first_value > second_value\n    elif operator == \"<\":\n        bool_ = first_value < second_value\n    elif operator == \">=\":\n        bool_ = first_value >= second_value\n    elif operator == \"!=\":\n        bool_ = first_value != second_value\n    else:\n        bool_ = first_value == second_value\n    return bool_\n\n\n@flojoy\ndef CONDITIONAL(v, params):\n    # print(\"EXECUTING CONDITIONAL, PARMAS: \", params, \" v: \", v)\n\n    operator = params['operator_type']\n\n    y1 = v[0].y\n    y2 = v[1].y\n    bool_ = compare_values(y1[0], y2[0], operator)\n    data = None\n    if operator in [\"<=\", \"<\"]:\n        if not bool_:\n            data = DataContainer(x=v[0].x, y=v[0].y)\n        else:\n            data = DataContainer(x=v[1].x, y=v[1].y)\n    else:\n        if bool_:\n            data = DataContainer(x=v[0].x, y=v[0].y)\n        else:\n            data = DataContainer(x=v[1].x, y=v[1].y)\n\n    next_direction = str(bool_).lower()\n\n    return JobResultBuilder().from_data(data).flow_to_directions([next_direction]).build()"}, "LOOP": {"LOOP.py": "import numpy as np\nfrom flojoy import flojoy, DataContainer, JobResultBuilder\n\n\n@flojoy\ndef LOOP(v, params):\n    print(\"EXECUTING LOOP, params:\", params)\n    if len(v) == 0 or np.any(v[0].y) == None:\n        x = list()\n        for i in range(1000):\n            x.append(i)\n        y = np.full(1000, 1)\n\n        data = DataContainer(x=x, y=y)\n    else:\n        x = v[0].x\n        y = v[0].y\n\n        if x is None:\n            x = np.full(len(y), 1)\n\n        data = DataContainer(x=x, y=y)\n\n    return JobResultBuilder().from_data(data).flow_to_directions(['body']).build()", "LOOP_CONDITIONAL.py": "from flojoy import flojoy, DataContainer\nimport os\nfrom flojoy import JobResultBuilder\nfrom redis import Redis\nimport json\n\nREDIS_HOST = os.environ.get('REDIS_HOST', 'localhost')\nREDIS_PORT = os.environ.get('REDIS_PORT', 6379)\nr = Redis(host=REDIS_HOST, port=REDIS_PORT)\n\n\ndef get_redis_obj(key):\n    get_obj = r.get(key)\n    parse_obj = json.loads(get_obj) if get_obj is not None else {}\n    return parse_obj\n\n\ndef compare_values(first_value, second_value, operator):\n    bool_ = None\n    if operator == \"<=\":\n        bool_ = first_value <= second_value\n    elif operator == \">\":\n        bool_ = first_value > second_value\n    elif operator == \"<\":\n        bool_ = first_value < second_value\n    elif operator == \">=\":\n        bool_ = first_value >= second_value\n    elif operator == \"!=\":\n        bool_ = first_value != second_value\n    else:\n        bool_ = first_value == second_value\n    return bool_\n\n\ndef get_loop_params(r_obj, loop_node_id, key):\n    return r_obj.get('SPECIAL_TYPE_JOBS', {}).get('LOOP', {}).get(\n        loop_node_id, {}).get('params', {}).get(key, None)\n\n\n@flojoy\ndef LOOP_CONDITIONAL(v, params):\n    loop_node = params.get('loop_node')\n    next_nodes = None if loop_node is None else [loop_node]\n    return JobResultBuilder().from_params(v).flow_to_nodes(next_nodes).build()\n\n# @flojoy\n# def LOOP_CONDITIONAL(v, params):\n#     print(\"EXECUTING LOOP CONDITIONAL, PARMAS: \", params, \" v: \", v)\n\n#     loop_node_id = params['loop_node']\n#     jobset_id = params['jobset_id']\n#     operator = params['operator_type']\n\n#     r_obj = get_redis_obj(jobset_id)\n\n#     initial_value = get_loop_params(\n#         r_obj, loop_node_id, 'initial_value')\n#     total_iterations = get_loop_params(\n#         r_obj, loop_node_id, 'total_iterations')\n#     step = get_loop_params(r_obj, loop_node_id, 'step')\n#     current_iteration = get_loop_params(\n#         r_obj, loop_node_id, 'current_iteration')\n\n#     is_loop_finished = compare_values(\n#         current_iteration+step, total_iterations, operator)\n\n#     params = {\n#         \"initial_value\": initial_value,\n#         \"total_iterations\": total_iterations,\n#         \"current_iteration\": current_iteration,\n#         \"step\": step\n#     }\n\n#     result = {\n#         \"__result__field__\": \"data\",\n#         \"data\": DataContainer(x=v[0].x, y=v[0].y),\n#         \"type\": 'LOOP',\n#         \"params\": params,\n#         \"verdict\": 'finished'\n#     }\n\n#     if is_loop_finished:\n#         return result\n#     else:\n#         return {\n#             **result,\n#             \"params\": {\n#                 **params,\n#                 \"current_iteration\": current_iteration + step,\n#             },\n#             \"verdict\": 'ongoing'\n#         }\n"}, "TIMER": {"TIMER.py": "from flojoy import flojoy,DataContainer\nimport time\n\n@flojoy\ndef TIMER(v,params):\n    print(\"executing timer\")\n\n    seconds = int(params['sleep_time'])\n    time.sleep(seconds)\n\n    if len(v) == 0:\n        return DataContainer(x=None,y=None)\n\n\n    return DataContainer(x=v[0].x,y=v[0].y)"}, "SIGNAL_PROCESSING": {"BUTTER.py": "from scipy import signal\nimport numpy as np\nfrom flojoy import flojoy, DataContainer\n\n\n@flojoy\ndef BUTTER(v, params):\n    ''' Apply a butterworth filter to an input vector '''\n\n    print('Butterworth inputs:', v)\n\n    sig = v[0].y\n\n    sos = signal.butter(10, 15, 'hp', fs=1000, output='sos')\n    filtered = signal.sosfilt(sos, sig)\n\n    return DataContainer(x = sig, y = filtered)\n"}, "LOADER": {"LOCAL_FILE.py": "import traceback\nfrom flojoy import flojoy,DataContainer\n\n@flojoy\ndef LOCAL_FILE(v, params):\n    print('parameters passed to LOCAL_FILE: ', params)\n    try:\n        filePath = ''\n        y = {}\n        if v is not None and len(v) != 0:\n            filePath = v[0].y\n        ctrlInput = params['path']\n        fileType = params['file_type']\n        opType = params['op_type']\n        if ctrlInput is not None and len(ctrlInput.strip()) > 0:\n            filePath = ctrlInput\n        elif len(filePath.strip()) == 0:\n            if fileType == 'image' and opType == 'OD':\n                filePath = \"../public/assets/object_detection.png\"\n        print (\"File to be loaded: \" + filePath)\n        with open(filePath, \"rb\") as fileToBeLoaded:\n            f = fileToBeLoaded.read()\n            y = [bytearray(f)]\n        fileToBeLoaded.close()\n    except Exception:\n        print(traceback.format_exc())\n\n    return DataContainer(type = 'file', y = y, file_type = [fileType])\n"}, "ARRAY_AND_MATRIX": {"MATMUL.py": "import numpy as np\nfrom flojoy import flojoy, DataContainer\n\n@flojoy\ndef MATMUL(v, params):\n    ''' Takes 2 input matrices, multiplies them, and returns the result '''\n    a = np.eye(3)\n    b = np.eye(3)\n    if len(v) == 2:\n        a = v[0].y\n        b = v[1]['y']\n    return DataContainer(type='matrix', m=np.matmul(a, b))", "INVERT.py": "import numpy as np\nfrom flojoy import flojoy, DataContainer\n\n@flojoy\ndef INVERT(v, params):\n    ''' Takes 2 inputs, one matrix and one rcond if not square matrix.\n    Inverts them (or pseudo invert) and returns the result. \n    If the entered value is a scalar it returns the multiplciative\n    inverse 1/x '''\n    print(f'INVERT params: {params}')\n    a = np.eye(3)\n    b = float(params['rcond'])\n\n    if v.__len__ >0:\n        if (v[0].type == 'ordered_pair'): # v[0] is a DataContainer object with type attribute\n            print('Performing simple inversion')\n            a = v[0].y #scalar valued\n            return DataContainer(x=a, y=1/a)\n        elif (v[0].type == 'matrix'):\n            a = v[0].m\n            if (not a.shape[0] == a.shape[1]):\n                print('Not square matrix! Using pseudoinversion...')\n                assert type(b)==float, \"Need scalar value to compare SVDs for pseudoinversion\"\n                retval = np.linalg.pinv(a, rcond=b, hermitian=False)\n            else:\n                try:\n                    retval = np.linalg.inv(a)\n                except np.linalg.LinAlgError:\n                    raise ValueError('Inversion failed! Singular matrix returned...')\n            return DataContainer(type='matrix',m=retval)\n        else:\n            raise ValueError('Incorrect input DataContainer type.')\n    else:\n        return DataContainer(type='matrix',m=np.eye(3))\n"}}